<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
		<title>Singgit</title>
		<link rel="icon" href="data:,">
		<link rel="manifest" href="manifest.json">

		<link rel="stylesheet" href="font/icomoon/style.css">
		<link rel="stylesheet" href="lib/bootstrap/bootstrap.min.css">
		<link rel="stylesheet" href="lib/singgit.css">
	</head>
	<body>
		<div id="singgit" v-cloak>
			<div class="tab-content row">
				<div role="tabpanel" class="tab-pane col-md-3 active" id="form">
					<form id="formTransaction" class="card max-height" autocomplete="off">
						<div class="card-header row d-flex justify-content-between">
							{{formTitle}}
							<span>{{version_js}}</span>
						</div>
						<div class="form-group row">
							<label class="col-4 col-form-label">Amount</label>
							<div class="col-8">
								<div class="input-group">
									<input type="text" class="form-control" id="amount" name="amount">
									<div class="input-group-append pointer">
										<span class="input-group-text" :class="{'negative':isExpenses, 'positive':!isExpenses}" @click="isExpenses=!isExpenses"><i :class="{'icon-minus':isExpenses, 'icon-plus':!isExpenses}"></i></span>
									</div>
								</div>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-4 col-form-label">Description</label>
							<div class="col-8">
								<div class="input-group">
									<input type="text" class="form-control" id="description" name="description">
									<div class="input-group-append">
										<span class="input-group-text favourite" :class="{'active':isFavourite}" @click="isFavourite=!isFavourite"><i class="icon-heart"></i></span>
									</div>
								</div>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-4 col-form-label">Account</label>
							<div class="col-8">
								<select class="form-control" id="account" name="account">
									<option v-for="item in accounts" :value="item.desc">{{item.desc}}</option>
								</select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-4 col-form-label">Category</label>
							<div class="col-8">
								<select class="form-control" id="category" name="category">
									<option v-for="item in categories" :value="item">{{item}}</option>
								</select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-4 col-form-label">Transfer To</label>
							<div class="col-8">
								<select class="form-control" id="transfer" name="transfer">
									<option value=""></option>
									<option v-for="item in accounts" :value="item.desc">{{item.desc}}</option>
								</select>
							</div>
						</div>
						<div class="form-group row">
							<label class="col-4 col-form-label">Date</label>
							<div class="col-8">
								<input type="date" class="form-control" id="date" name="date">
								<div class="input-group fake-date">
									<input type="date" class="form-control">
									<div class="input-group-append">
										<span class="input-group-text"><i class="icon-calendar"></i></span>
									</div>
								</div>
							</div>
						</div>
						<div class="form-group row">
							<div class="btn-group col-12" role="group">
								<button type="button" class="btn btn-primary col" @click="newTransaction()">New</button>
								<button type="button" class="btn btn-primary col d-none" @click="deleteTransaction()" :class="{'d-inline-block':editItem!=null}">Delete</button>
								<button type="button" class="btn btn-primary col d-none" @click="saveAsTransaction()" :class="{'d-inline-block':editItem!=null}">Save As</button>
								<button type="button" class="btn btn-primary col" @click="saveTransaction()">Save</button>
							</div>
						</div>
					</form>
				</div>
				<div role="tabpanel" class="tab-pane col-md-3" id="transaction">
					<div class="card max-height">
						<div class="card-header row">
							<div class="input-group">
								<input type="text" class="form-control" v-model.lazy="filter_description">
								<div class="input-group-append">
									<span class="input-group-text pointer" data-toggle="modal" data-target="#modalFilter">
										<span data-toggle="tooltip" data-placement="bottom" title="Open filter dialog"><i class="icon-filter"></i></span>
									</span>
									<span class="input-group-text pointer" @click="copyToClipboard()">
										<span data-toggle="tooltip" data-placement="bottom" title="Copy to clipboard"><i class="icon-clipboard"></i></span>
									</span>
								</div>
							</div>
						</div>
						<div class="scrollArea" :class="{'text-center':loading}">
							<div v-if="loading" class="spinner-border m-5" role="status"></div>

							<!-- original
							-->
							<ul v-else id="contentArea" class="list-group">
								<li v-for="(item, index) in filteredTransactions" :key="item.id" class="list-group-item d-flex align-items-center" :class="{'counted':countedCart[index]}">
									<div class="transactionDate">{{item.formatteddate}}</div>
									<template v-if="item.description=='Reconcile'">
										<div class="reconcile" @click="editTransaction(index)"></div>
									</template>
									<template v-else>
										<div class="transactionDescription" @click="editTransaction(index)">
											{{item.description}}<br>
											{{item.account[0]}}<template v-if="item.account[1]">: <span class="transactionCategory">{{item.category}}</span>: <span>to {{item.account[1]}}</span></template>
										</div>
										<div class="negative" :class="{'positive': item.amount>=0 && item.account[1]!='Loan', 'strikethrough': item.category=='Exclude Stat'}" @click="countedCart[index]=!countedCart[index]; counted+=item.amount;">{{toCurrency(item.amount)}}</div>
									</template>
								</li>
							</ul>
							
							<!-- lib/vue-virtual-scroll-list/index.js tp slow bila nak edit
							<virtual-list v-else id="contentArea" wclass="list-group" wtag="ul" :size="100" :remain="15">
								<li v-for="(item, index) in filteredTransactions" :key="index" class="list-group-item d-flex align-items-center" :class="{'counted':countedCart[index]}" :data-formatteddate="item.formatteddate" :data-description="item.description" :data-account0="item.account[0]" :data-account1="item.account[0]" :data-category="item.category" :data-amount="item.amount">
									<div class="transactionDate">{{item.formatteddate}}</div>
									<template v-if="item.description=='Reconcile'">
										<div class="reconcile" @click="editTransaction(index)"></div>
									</template>
									<template v-else>
										<div class="transactionDescription" @click="editTransaction(index)">
											{{item.description}}<br>
											{{item.account[0]}}
											<template v-if="item.account[1]">to {{item.account[1]}}</template>
											<template v-else>: <span class="transactionCategory">{{item.category}}</span></template>
										</div>
										<div class="negative" :class="{'positive': item.amount>=0 && item.account[1]!='Loan', 'strikethrough': item.category=='Exclude Stat'}" @click="countedCart[index]=!countedCart[index]; counted+=item.amount;">{{toCurrency(item.amount)}}</div>
									</template>
								</li>
							</virtual-list>
							-->
							
						</div>
					</div>
					<div v-if="counted" class="countedContainer">{{counted.toFixed(2)}}</div>
				</div>
				<div role="tabpanel" class="tab-pane col-md-3" id="statistic">
					<div class="card max-height">
						<div class="card-header row d-flex justify-content-between">
							Statistic
							<div class="d-none">{{filteredTransactions.length}}</div>
							<span>
								<i class="icon-arrow-left p-2" @click="statFilter[0].add(-1, 'months'); statFilter.push(1)"></i>
								{{statFilter[0].format('MMM YYYY')}}
								<i class="icon-arrow-right p-2" @click="statFilter[0].add(1, 'months'); statFilter.push(1)"></i>
							</span>
						</div>
						<div class="statContent" :class="{'text-center':loading}">
							<div v-if="loading" class="spinner-border m-5" role="status"></div>
							<template v-else>
								<ul class="list-group">
									<li class="list-group-item d-flex justify-content-between align-items-center list-header">CURRENT BALANCE <span class="negative" :class="{positive:accounts_balance_all>=0, negative:accounts_balance_all<0}">{{toCurrency(accounts_balance_all-accounts_balance['THJ']-accounts_balance['Loan'])}}</span></li>
									<li class="list-group-item d-flex justify-content-between align-items-center" v-for="item in accounts">
										<span class="text-nowrap" @click="item.adjustorShow=!item.adjustorShow">{{item.desc}}</span>
										<template v-if="item.adjustorShow">
											<span class="w-100"></span>
											<span class="negative" :class="{positive:accounts_balance[item.desc]>=0, negative:accounts_balance[item.desc]<0}">{{toCurrency(accounts_balance[item.desc])}}</span>
											<span class="pl-1 pr-1">-</span>
											<input type="text" v-model="item.adjustorValue" class="ml-1 w-50 adjustor">
											<span class="pl-1 pr-1">=</span>
											<span>{{toCurrency(accounts_balance[item.desc] - Number(item.adjustorValue.toString().replace(/,/gi,'')))}}</span> 
										</template>
										<template v-else>
											<span class="negative" :class="{positive:accounts_balance[item.desc]>=0, negative:accounts_balance[item.desc]<0}">{{toCurrency(accounts_balance[item.desc])}}</span>
										</template>
									</li>
								</ul>
								
								<ul class="list-group mt-3">
									<li class="list-group-item d-flex justify-content-between align-items-center list-header">MONTHLY PERFORMANCE <span class="negative" :class="{positive:income+expenses>=0, negative:income+expenses<0}">{{toCurrency(income+expenses)}}</span></li>
									<li class="list-group-item d-flex justify-content-between align-items-center" @click="quickFilter('income')">
										Income
										<span class="negative" :class="{positive:income>=0, negative:income<0}">{{toCurrency(income)}}</span>
									</li>
									<li class="list-group-item d-flex justify-content-between align-items-center" @click="quickFilter('expenses')">
										Expenses
										<span class="negative" :class="{positive:expenses>=0, negative:expenses<0}">{{toCurrency(expenses)}}</span>
									</li>
								</ul>
								
								<ul class="list-group mt-3">
									<li class="list-group-item list-header">MONTHLY EXPENSES</li>
									<li class="list-group-item d-flex justify-content-between align-items-center" v-for="item in categories" v-if="['Income','Transfer','Exclude Stat'].indexOf(item)<0" @click="quickFilter(item)">
										{{item}}
										<span class="negative" :class="{positive:categories_expenses[item]>=0, negative:categories_expenses[item]<0}">{{toCurrency(categories_expenses[item])}}</span>
									</li>
								</ul>
							</template>
						</div>
					</div>
				</div>
				<div role="tabpanel" class="tab-pane col-md-3" id="favourite">
					<div class="card max-height">
						<div class="card-header row d-flex justify-content-between align-items-center">
							Favourite
							<span>
								<i class="icon-git-merge pointer p-2" @click="mergeFavourite()" :class="{'dimm':favouriteLoading}" data-toggle="tooltip" data-placement="bottom" title="Merge Favourite"></i>
								<i class="icon-share favourite-upload pointer p-2" @click="uploadFavourite()" data-toggle="tooltip" data-placement="bottom" title="Upload Favourite"></i>
							</span>
						</div>
						<div class="scrollArea" :class="{'text-center':loading}">
							<div v-if="loading" class="spinner-border m-5" role="status"></div>
							<ul v-else class="list-group">
								<li class="list-group-item d-flex align-items-center" v-for="(item,index) in favourite">
									<div class="transactionDescription">
										<input class="border-0 p-0 w-100" v-model="item.value"><br>
										<template v-if="item.transfer!=''">{{item.account}} <span>to {{item.transfer}}</span></template>
										<template v-else>{{item.account}} <span class="transactionCategory">{{item.category}}</span></template>
									</div>
									<div class="favouriteDelete pointer" @click="deleteFavourite(index)">
										<i class="icon-trash"></i>
									</div>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			
			<ul class="nav nav-pills fixed-bottom border-top d-md-none" role="tablist">
				<li class="nav-item col"><a href="#form" role="tab" data-toggle="pill" class="nav-link text-center active" @click="newTransaction()"><i class="icon-file"></i></a></li>
				<li class="nav-item col"><a href="#transaction" role="tab" data-toggle="pill" class="nav-link text-center" @click="fetchTransactions()"><i class="icon-book-open"></i></a></li>
				<li class="nav-item col"><a href="#statistic" role="tab" data-toggle="pill" class="nav-link text-center" @click="fetchTransactions()"><i class="icon-trending-up"></i></a></li>
				<li class="nav-item col"><a href="#favourite" role="tab" data-toggle="pill" class="nav-link text-center" @click="fetchTransactions()"><i class="icon-star"></i></a></li>
			</ul>
			
			<div id="modalGeneral" class="modal fade" tabindex="-1" role="dialog">
				<div class="modal-dialog modal-dialog-centered modal-sm" role="document">
					<div class="modal-content">
						<div class="modal-body text-center">?</div>
					</div>
				</div>
			</div>
			
			<div id="modalFilter" class="modal fade" tabindex="-1" role="dialog">
				<div class="modal-dialog modal-dialog-centered" role="document">
					<form id="formFilter" class="modal-content">
						<div class="modal-body">
							<div class="form-group row">
								<label class="col-12 col-form-label">Account</label>
								<div class="col-12">
									<select class="form-control" v-model="filter_account">
										<option value=""></option>
										<option v-for="item in accounts" :value="item.desc">{{item.desc}}</option>
									</select>
								</div>
							</div>
							<div class="form-group row">
								<label class="col-12 col-form-label">Category</label>
								<div class="col-12">
									<select class="form-control" v-model="filter_category">
										<option value=""></option>
										<option v-for="item in categories" :value="item">{{item}}</option>
									</select>
								</div>
							</div>
							<div class="form-group row">
								<label class="col-12 col-form-label">Date</label>
								<div class="col-6 hyphen">
									<input type="date" id="filter_from" class="form-control" v-model="filter_from">
									<div class="input-group fake-date">
										<input type="date" class="form-control">
										<div class="input-group-append">
											<span class="input-group-text"><i class="icon-calendar"></i></span>
										</div>
									</div>
								</div>
								<div class="col-6">
									<input type="date" id="filter_to" class="form-control" v-model="filter_to">
									<div class="input-group fake-date">
										<input type="date" class="form-control">
										<div class="input-group-append">
											<span class="input-group-text"><i class="icon-calendar"></i></span>
										</div>
									</div>
								</div>
							</div>
							<div class="form-group row">
								<label class="col-12 col-form-label">Type</label>
								<div class="col-12">
									<select class="form-control" v-model="filter_type">
										<option value=""></option>
										<option value="income">Income</option>
										<option value="expenses">Expenses</option>
									</select>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary" @click="resetFilter()">Clear</button>
							<button type="button" class="btn btn-primary" data-dismiss="modal">Ok</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<textarea id="clipboard"></textarea>
		
		<script>
			if('serviceWorker' in navigator) {
				window.addEventListener('load', () => {
					navigator.serviceWorker.register('sw.js');
				});
			}
		</script>
		
		<script src="lib/jquery/jquery-3.3.1.min.js"></script>
		<script src="lib/firebase/firebase.js"></script>
		<script src="lib/firebase/firebase-firestore.js"></script>
		<script src="lib/bootstrap/popper.min.js"></script>
		<script src="lib/bootstrap/bootstrap.min.js"></script>
		<script src="lib/moment/moment.min.js"></script>
		<script src="lib/vue/vue.js"></script>
		<script src="lib/jquery.autocomplete/jquery.autocomplete.min.js"></script>
		<script src="lib/singgit.js"></script>
	</body>
</html>